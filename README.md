# QuickOn — система для обучения новых сотрудников

- [Общая информация](#info)

- [Работа с приложением](#work)
  - [Управление приложением (Makefile)](#work-management)
  - [Локальный запуск приложения](#work-local)
  - [Локальный запуск приложения](#work-develop)

- [Архитектура](#arch)
  - [Схема БД](#arch-db)


# Общая информация <a name="info"/>

Реализация HTTP API системы для обучения новых сотрудников «QuickOn»: проект курса «Акселератор».


# Работа с приложением <a name="work"/>

## Управление приложением (Makefile) <a name="work-management"/>
Подготовка приложения, тестирование, запуск на локальной машине и другие команды, выполняется с помощью команды make (из корня репозитория).  
В Makefile определены основные команды для управления приложением:  

- Информация о доступных командах Makefil-а:
  ```
  make info
  ```
- Запуск тестов приложения
  ```
  make test
  ```
- Форматирование кода
  ```
  make fmt
  ```
- Генерация API-документации (swagger)
  ```
  make swag
  ```
- Создание и запуск контейнеров, необходимых для работы всего приложения (локально)
  ```
  make docker-app-up
  ```
- Остановка и удаление контейнеров, созданных командой выше (docker-dev-up)
  ```
  make docker-app-down
  ```
- Создание и запуск контейнера c БД для разработки и отладки приложения  
  ```
  make docker-dev-db-up
  ```
- Остановка и удаление контейнера, созданного предыдущей командой (docker-dev-db-up)
  ```
  make docker-dev-db-down
  ```

  
Подробнее: [Makefile](Makefile)  

## Локальный запуск приложения <a name="work-local"/>

Для локального запуска приложения достаточно запустить `make docker-app-up` на Linux системе.
При этом в папку frontend будет скачан [проект frontend из ветки develop](https://github.com/training-of-new-employees/qon/tree/develop), а из него будет собран новый образ frontend'a.

После запуска для доступа к приложению переходим на http://localhost:8080/, тут будет доступен как frontend, так и backend.
Чтобы получить swagger-спецификацию проекта переходим на страницу http://localhost:8081/swagger/index.html

## Отправка PR на ревью
Перед отправкой PR на ревью следует выполнить форматирование кода и сгенерировать актуальную swagger документацию:
```bash
make swag
make fmt
```

# Архитектура <a name="arch"/>

## Схема БД <a name="arch-db"/>

![Схема БД](images/db-quickon.png)

Подробнее: [migrations/01_postgres_qon.sql](migrations/01_postgres_qon.sql)

### Компании (companies)

Таблица **companies** содержит данные о компаниях/организациях пользователей.

Поля таблицы:

- **id** - идентификатор компании (первичный ключ);
- **active** - поле для определения активности компании (true - активна; false - неактивна);
- **archived** -  поле для определения в архиве ли запись (true - в архиве; false - не в архиве);
- **name** - название компании;
- **created_at** - дата создания записи;
- **updated_at** - дата обновления записи

### Должности (positions)

Таблица **positions** содержит данные о должностях компании.

Поля таблицы:

- **id** - идентификатор должности (первичный ключ);
- **company_id** - идентификатор компании, с которой связана должность
(внешний ключ - ссылка на таблицу **companies**)
- **active** - поле для определения активности должности (true - активна; false - неактивна);
- **archived** -  поле для определения в архиве ли запись (true - в архиве; false - не в архиве);
- **name** - название должности;
- **created_at** - дата создания записи;
- **updated_at** - дата обновления записи.

### Пользователи (users)

Таблица **users** содержит данные о пользователях.

Поля таблицы:

- **id** - идентификатор пользователя (первичный ключ);
- **company_id** - идентификатор компании пользователя (внешний ключ - ссылка на таблицу **companies**);
- **position_id** - идентификатор должности (внешний ключ - ссылка на таблицу **positions**);
- **active** - поле для определения активности пользователя (true - активен; false - неактивен);
- **archived** -  поле для определения в архиве ли запись (true - в архиве; false - не в архиве);
- **admin** - признак администратор (true - администратор);
- **email** - электронная почта;
- **enc_password** - захешированный пароль;
- **name** - имя;
- **patronymic** - отчество;
- **surname** - фамилия;
- **created_at** - дата создания записи;
- **updated_at** - дата обновления записи пользователя.

### Курсы (courses)

Таблица **courses** содержит данные о курсах.

Поля таблицы:

- **id** - идентификатор курса (первичный ключ);
- **created_by** - создатель курса (внешний ключ - ссылка на таблицу **users**);
- **active** - поле для определения активности курса (true - активен; false - неактивен);
- **archived** -  поле для определения в архиве ли запись (true - в архиве; false - не в архиве);
- **name** - название курса;
- **description** - описание (дополнительная информация);
- **created_at** - дата создания курса.
- **updated_at** - дата обновления курса.

### Уроки (lessons)

Таблица **lessons** содержит данные об уроках.

Поля таблицы:

- **id** - идентификатор урока (первичный ключ);
- **course_id** - идентификатор курса, с которым связан урок (внешний ключ - ссылка на таблицу **courses**);
- **created_by** - создатель урока (внешний ключ - ссылка на таблицу **users**);
- **active** - поле для определения активности урока (true - активен; false - неактивен);
- **archived** -  поле для определения в архиве ли запись (true - в архиве; false - не в архиве);
- ***number** - номер для определения расположения урока в рамках курса  (**пока не используется, может понадобиться в будущем*);
- **name** - название урока;
- ***description** - дополнительная информация к уроку (**пока не используется, может понадобиться в будущем*);
- **created_at** - дата создания урока.
- **updated_at** - дата обновления урока.

### Тексты (texts)

Таблица **texts** содержит тексты, относящиеся к урокам.

Поля таблицы:

- **id** - идентификатор текста (первичный ключ);
- **lesson_id** - идентификатор урока, с которым связан текст (внешний ключ - ссылка на таблицу **lessons**);
- **created_by** - создатель учебного материала (внешний ключ - ссылка на таблицу **users**);
- ***number** - номер для определения расположения учебного материала в рамках урока (**пока не используется, может понадобиться в будущем*);
- ***header** - заголовок (**пока не используется, может понадобиться в будущем*);
- **content** - содержание;
- **created_at** - дата создания учебного материала;
- **updated_at** - дата обновления учебного материала.

### Картинки (pictures)

Таблица **pictures** содержит картинки, относящиеся к урокам.

Таблица содержит следующие поля:

- **id** - идентификатор картинки (первичный ключ);
- **lesson_id** - идентификатор урока, с которым связана картинка (внешний ключ - ссылка на таблицу **lessons**);
- **created_by** - создатель учебного материала (внешний ключ - ссылка на таблицу **users**);
- ***number** - номер для определения расположения учебного материала в рамках урока (**пока не используется, может понадобиться в будущем*);
- ***name** - название (**пока не используется, может понадобиться в будущем*);
- **link** - ссылка на картинку;
- **created_at** - дата создания учебного материала.
- **updated_at** - дата обновления учебного материала.

### Курсы-должности (position_course)

Таблица **position_course** используется для привязки курса к должности .

Поля таблицы:

- **id** - идентификатор записи (первичный ключ);
- **position_id** - идентификатор должности (внешний ключ - ссылка на таблицу **positions**);
- **course_id** - идентификатор курса (внешний ключ - ссылка на таблицу **courses**);

### Назначенные курсы (course_assign)

Таблица **course_assign** содержит назначенные курсы [пользователям].

Поля таблицы:

- **user_id** - идентификатор пользователя, которому назначен курс (внешний ключ - ссылка на таблицу **positions**);
- **course_id** - идентификатор курса, назначенного пользователю (внешний ключ - ссылка на таблицу **courses**);
- **pass_course** - статус прохождения курса (true - успешно пройден, false - не пройден)
- **started_at** - дата начала прохождения курса
- **finished_at** - дата завершения прохождения курса

### Прогресс по урокам (lesson_results)

Таблица **lesson_results** отображает прогресс по урокам.

Поля таблицы:

- **user_id** - идентификатор пользователя, которому назначен урок (внешний ключ - ссылка на таблицу **positions**);
- **course_id** - идентификатор курса, назначенного пользователю (внешний ключ - ссылка на таблицу **courses**);
- **lesson_id** - идентификатор урока (внешний ключ - ссылка на таблицу **lessons**);
- **pass_lesson** - поле для определения прогресса по текущему уроку (true - пройден; false - не пройден);